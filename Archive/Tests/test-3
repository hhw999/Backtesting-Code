import pandas as pd
import requests

# Define API credentials
api_token = 'YOUR_API_TOKEN'
account_id = 'YOUR_ACCOUNT_ID'

# Define API endpoints
base_url = 'https://api.fxcm.com'
auth_endpoint = '/trading/authentication/token'
data_endpoint = '/trading/candles/history'

# Set parameters for data request
symbol = 'GBP/USD'
start_date = '2018-01-01'
end_date = '2023-06-30'
periodicity_4h = 'H4'  # 4-hour data
periodicity_15min = 'M15'  # 15-minute data
formatting = 'json'

# Authenticate and retrieve access token
auth_params = {
    'grant_type': 'client_credentials',
    'client_id': api_token,
    'account_id': account_id
}
auth_response = requests.post(base_url + auth_endpoint, data=auth_params)
access_token = auth_response.json()['access_token']

# Set headers for data request
headers = {
    'Authorization': f'Bearer {access_token}'
}

# Define parameters for 4-hour data request
data_params_4h = {
    'symbol': symbol,
    'from': start_date,
    'to': end_date,
    'periodicity': periodicity_4h,
    'format': formatting
}

# Send 4-hour data request and retrieve the response
data_response_4h = requests.get(base_url + data_endpoint, params=data_params_4h, headers=headers)
data_4h = data_response_4h.json()

# Define parameters for 15-minute data request
data_params_15min = {
    'symbol': symbol,
    'from': start_date,
    'to': end_date,
    'periodicity': periodicity_15min,
    'format': formatting
}

# Send 15-minute data request and retrieve the response
data_response_15min = requests.get(base_url + data_endpoint, params=data_params_15min, headers=headers)
data_15min = data_response_15min.json()

# Process and convert data to pandas DataFrames
df_4h = pd.DataFrame(data_4h['candles'])
df_15min = pd.DataFrame(data_15min['candles'])

# Print the 4-hour data DataFrame
print("4-Hour Data:")
print(df_4h)

# Print the 15-minute data DataFrame
print("15-Minute Data:")
print(df_15min)
